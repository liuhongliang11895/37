<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Loading...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>
    async function redirect() {
      try {
        const res = await fetch("mapping.json?ts=" + Date.now()); // 防缓存
        const data = await res.json();
        const activeLinks = data.links.filter(l => l.active);

        if (activeLinks.length === 0) return;

        // --- 读取已访问过的链接 ---
        const visited = JSON.parse(localStorage.getItem("visitedLinks") || "[]");

        // --- 过滤掉已访问的 ---
        let available = activeLinks.filter(l => !visited.includes(l.url));

        // --- 如果全都访问过，则重置（重新开始） ---
        if (available.length === 0) {
          localStorage.removeItem("visitedLinks");
          available = activeLinks;
        }

        // --- 平均分配：随机从剩余中取一个 ---
        const target = available[Math.floor(Math.random() * available.length)];

        // --- 记录这次访问 ---
        visited.push(target.url);
        localStorage.setItem("visitedLinks", JSON.stringify(visited));

        // --- 跳转 ---
        window.location.replace(target.url);

      } catch (e) {
        console.error("跳转失败：", e);
        document.body.innerHTML = "<h2>加载失败，请稍后重试。</h2>";
      }
    }

    redirect();
  </script>
</head>
<body>
</body>
</html>

